---
// src/components/ContentRenderer/variants/ContactVariant.astro
/**
 * Contact Variant - Contact information with social media
 * Features: Contact cards, embedded social media section, 1-3 columns
 */
import ContentRenderer from "../ContentRenderer.astro";
import type { BaseVariantProps } from "../ContentRenderer.types";
import ContactCard from "@/components/LoopComponents/ContactCard.astro";
import Button from "@/components/Button/Button";
import { query } from "@/utils/query";
import { shouldShowCollectionCTA } from "../utils/helpers";
import ContactForm from "@/components/Form/forms/ContactForm.astro";
import { toArray } from "@/utils/array";

interface Props extends BaseVariantProps {
  columns?: 1 | 2 | 3;
  ctaHref?: string;
  ctaText?: string;
}

const {
  items = [],
  title,
  description,
  className = "",
  columns = 2,
  collectionUrl,
  collectionTitle,
  id,
  showButtonSection = true,
  ctaHref,
  ctaText,
} = Astro.props as Props;

const safeItems = toArray(items);

const columnClasses = {
  1: "grid-cols-1",
  2: "grid-cols-1 md:grid-cols-2",
  3: "grid-cols-1 md:grid-cols-2 lg:grid-cols-3",
};
---

<section id={id} class={`py-16 w-full ${className}`}>
  <div class="flex flex-col-reverse lg:flex-row w-full">
    <div class="px-4">
      {safeItems.length > 0 && (
        <ul class={`flex flex-col gap-6 list-none`}>
          {safeItems.map((item) => (
            <li>
              <ContactCard {...item} />
            </li>
          ))}
        </ul>
      )}

      {showButtonSection &&
        shouldShowCollectionCTA(collectionUrl, safeItems.length) &&
        (ctaText || title || collectionTitle) &&
        (ctaHref || collectionUrl) && (
        <div class="mt-12 text-left">
          <Button
            href={ctaHref ?? collectionUrl}
            rightIcon="lu:arrow-right"
            variant="primary"
            size="lg"
          >
            {ctaText ?? `View All ${(title ?? collectionTitle ?? "").trim()}`}
          </Button>
        </div>
      )}
    </div>
    <div class="flex flex-col justify-between w-full">
      <ContactForm />
      <ContentRenderer
        query={query("social-media")}
        variant="SocialMediaVariant"
        title="Follow Us"
        size="lg"
        alignment="center"
      />
    </div>
  </div>
</section>
