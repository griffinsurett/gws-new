---
// src/layouts/Theme.astro

import "../styles/global.css";
---

<!-- Favicons -->
<link rel="shortcut icon" href="/3dfavicons/favicon.ico" />
<link rel="icon" type="image/png" sizes="16x16" href="/3dfavicons/favicon-16x16.png" />
<link rel="icon" type="image/png" sizes="32x32" href="/3dfavicons/favicon-32x32.png" />
<link rel="apple-touch-icon" sizes="180x180" href="/3dfavicons/apple-touch-icon.png" />
<link rel="manifest" href="/3dfavicons/site.webmanifest" />
<link rel="icon" type="image/svg+xml" href="/3dfavicons/favicon.ico" />

<!-- PWA manifest (uncomment when ready) -->
<!-- <link rel="manifest" href="favicon.svg" /> -->

<!-- Color scheme support -->
<meta name="color-scheme" content="dark light" />
<meta name="theme-color" content="var(--color-bg)" />
<meta name="mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

<!-- Theme detection script (runs before content loads to prevent FOUC) -->
<script is:inline>
  // Minimal blocking script - only set essential theme attributes
  (function() {
    var d = document.documentElement;
    var t = localStorage.getItem('theme');
    t = (t === 'light' || t === 'dark') ? t : 'dark';
    d.setAttribute('data-theme', t);
    d.style.colorScheme = t;
    var a = localStorage.getItem('accent');
    if (a) d.style.setProperty('--color-accent', a);
  })();
</script>
<!-- Deferred theme enhancements (non-blocking) -->
<script>
  // Update theme-color meta after paint - double-deferred to avoid forced reflow
  (function() {
    function updateThemeColor() {
      // Use rAF to batch with next paint, avoiding layout thrashing
      requestAnimationFrame(function() {
        var computed = getComputedStyle(document.documentElement).getPropertyValue('--color-bg').trim();
        if (computed) {
          var meta = document.querySelector('meta[name="theme-color"]');
          if (meta) meta.setAttribute('content', computed);
        }
      });
    }
    if ('requestIdleCallback' in window) {
      requestIdleCallback(updateThemeColor, { timeout: 2000 });
    } else {
      setTimeout(updateThemeColor, 100);
    }
  })();
</script>
