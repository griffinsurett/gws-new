---
// src/layouts/Theme.astro

import "../styles/global.css";
---

<!-- Favicons -->
<link rel="shortcut icon" href="/3dfavicons/favicon.ico" />
<link rel="icon" type="image/png" sizes="16x16" href="/3dfavicons/favicon-16x16.png" />
<link rel="icon" type="image/png" sizes="32x32" href="/3dfavicons/favicon-32x32.png" />
<link rel="apple-touch-icon" sizes="180x180" href="/3dfavicons/apple-touch-icon.png" />
<link rel="manifest" href="/3dfavicons/site.webmanifest" />
<link rel="icon" type="image/svg+xml" href="/3dfavicons/favicon.ico" />

<!-- PWA manifest (uncomment when ready) -->
<!-- <link rel="manifest" href="favicon.svg" /> -->

<!-- Color scheme support -->
<meta name="color-scheme" content="dark light" />
<meta name="theme-color" content="var(--color-bg)" />
<meta name="mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

<!-- Theme detection script (runs before content loads to prevent FOUC) -->
<script is:inline>
  // Prevent FOUC (Flash of Unstyled Content)
  (function() {
    try {
      // Get saved theme; default to dark unless user picked light
      const savedTheme = localStorage.getItem('theme');
      const theme = (savedTheme === 'light' || savedTheme === 'dark') ? savedTheme : 'dark';
      
      // Get saved accent color
      const accent = localStorage.getItem('accent') || 'var(--main-accent)';
      
      // Apply theme immediately
      const root = document.documentElement;
      root.setAttribute('data-theme', theme);
      root.style.setProperty('--color-accent', accent);
      
      // Set color-scheme for native elements
      root.style.colorScheme = theme;
      
      // Update theme-color meta tag
      const computed = getComputedStyle(root).getPropertyValue('--color-bg').trim();
      if (computed) {
        let meta = document.querySelector('meta[name="theme-color"]');
        if (!meta) {
          meta = document.createElement('meta');
          meta.setAttribute('name', 'theme-color');
          document.head.appendChild(meta);
        }
        meta.setAttribute('content', computed);
      }
    } catch (e) {
      // Fallback to dark theme if anything fails
      const root = document.documentElement;
      root.setAttribute('data-theme', 'dark');
      root.style.colorScheme = 'dark';
    }
  })();
</script>
