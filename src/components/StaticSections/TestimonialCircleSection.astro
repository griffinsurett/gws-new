---
// src/components/StaticSections/TestimonialCircleSection.astro
import ItemsTemplate from "@/components/ItemsTemplates/ItemsTemplate.astro";
import CircleImageItem from "@/components/LoopComponents/CircleImageItem/CircleImageItem.astro";
import Heading from "@/components/Heading";
import Counter from "@/components/Counter.jsx";
---

<div
  class="testimonials flex items-center gap-[var(--spacing-xl)] px-[var(--spacing-md)] md:px-0"
>
  <!-- clip the overflow so only the “stack” shows -->
  <ItemsTemplate
    collection="testimonials"
    query="getAll"
    ItemComponent={CircleImageItem}
    itemsClass="flex justify-center items-center"
    itemClass="circle -mr-2 lg:-mr-4 first:ml-0"
  />

  <div
    class="flex flex-col items-start"
  >
    <Heading tagName="h3" className="text-heading m-0 p-0"
      ><Counter
        client:load
        start={1}
        end={100}
        duration={200}
        className="inline-block"
      />+</Heading
    >
    <Heading tagName="p" className="text-small m-0 md:px-[var(--spacing-xs)]">
      Happy Clients
    </Heading>
  </div>
</div>
<script client:load>
  const circles = document.querySelectorAll(".testimonials .circle");
  let idx = 0;

  function pulse() {
    // Clear previous
    const prev = (idx - 1 + circles.length) % circles.length;
    circles[prev].classList.remove("heartbeat");

    // Add to current
    circles[idx].classList.add("heartbeat");

    // Advance, wrap if needed
    idx = (idx + 1) % circles.length;
  }

  // First pulse immediately, then every 800ms
  pulse();
  setInterval(pulse, 1600);
</script>